import re
import pandas as pd
import io


# To sort strings by digits inside the strings
def natural_key(string_):
    return [int(s) if s.isdigit() else s for s in re.split(r'(\d+)', string_)]


# To create a new Excel spreadsheet and assign names to the data frames and graphs
def write_dataframes_to_excel_sheet(data_frames, dir, name, figures):
    with pd.ExcelWriter(f'{dir}/{name}.xlsx', engine='xlsxwriter') as writer:
        workbook = writer.book
        worksheet = workbook.add_worksheet('Peel results')
        graphs_sheet = workbook.add_worksheet('Peel graphs')
        writer.sheets['Peel results'] = worksheet

        COLUMN = 0
        row = 0
        sample_type = ['MD1_dry', 'MD2_dry', 'MD3_dry', 'CD1_dry', 'CD2_dry', 'CD3_dry', 'MD1_wet', 'MD2_wet', 'MD3_wet', 'CD1_wet', 'CD2_wet', 'CD3_wet']

        n = 0
        for df in data_frames:
            worksheet.write_string(row, COLUMN, sample_type[n])
            row += 1
            df.to_excel(writer, sheet_name='Peel results',
                        startrow=row, startcol=COLUMN)
            row += df.shape[0] + 2
            n += 1

        a = 2
        b = 0
        for fig in figures:
            img_data = io.BytesIO()
            fig.savefig(img_data, format='png')
            graphs_sheet.insert_image(a, 2, sample_type[b], {'image_data': img_data})
            a += 45

        workbook.close()
